<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Delivery Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 text-gray-800 min-h-screen flex flex-col">
  <header class="bg-green-600 text-white py-4 shadow-md">
    <div class="container mx-auto flex justify-between items-center">
      <h1 class="text-2xl font-bold">Delivery Tracker</h1>
      <nav>
        <a href="#" class="text-white hover:text-gray-300 mx-4">Home</a>
        <a href="#" class="text-white hover:text-gray-300 mx-4">Support</a>
      </nav>
    </div>
  </header>

  <main class="container mx-auto my-10 p-6 bg-white rounded-lg shadow-lg flex-grow">
    <h2 class="text-xl font-semibold mb-4">Track Delivery in Real-Time</h2>
    <p id="demo" class="mb-4 text-gray-600"></p>

    <div class="flex items-center mb-6 space-x-2">
      <label for="orderid" class="block text-gray-700 font-medium">Enter Order IDs (comma-separated):</label>
      <input id="orderid" type="text" class="w-2/3 p-2 border border-gray-300 rounded-lg" placeholder="123,456,789">
    </div>

    <div class="flex space-x-4">
      <button onclick="disconnectServer()" class="w-1/2 bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition-colors">
        Disconnect from Server
      </button>
      <button onclick="gpssend()" class="w-1/2 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
        Send Location to Server
      </button>
    </div>
  </main>

  <footer class="bg-gray-800 text-white py-4">
    <div class="container mx-auto text-center">
      <p>&copy; 2024 Delivery Tracker. All rights reserved.</p>
    </div>
  </footer>

  <script>
    let ws = null;
    let gps = {};
    let interval = null;

    function disconnectServer() {
      if (!ws) {
        console.log("Not connected to server.");
        return;
      }
      ws.close();
      clearInterval(interval);
      ws = null;
      console.log("Disconnected from server.");
    }

    function gpssend() {
      if (ws) {
        console.log("Already connected. Disconnect first to reconnect.");
        return;
      }

      ws = new WebSocket("wss://producttrack-production.up.railway.app"); // change to wss://yourdomain.com when deployed

      ws.onopen = () => {
        const orderInput = document.getElementById("orderid").value;
        const orderIds = orderInput.split(",").map(id => id.trim()).filter(Boolean);

        console.log("Connected. Registering delivery guy with orders:", orderIds);
        ws.send(JSON.stringify({ type: "register_delivery_guy", orders: orderIds }));

        // Get initial location
        navigator.geolocation.getCurrentPosition((location) => {
          gps.latitude = location.coords.latitude;
          gps.longitude = location.coords.longitude;
        });

        // Send location every 3 seconds
        interval = setInterval(() => {
          if (gps.latitude && gps.longitude) {
            const data = { type: "gpsupdate", gps };
            console.log("Sending GPS update:", data);
            ws.send(JSON.stringify(data));
          }
        }, 3000);
      };

      ws.onclose = () => {
        console.log("Connection closed.");
        clearInterval(interval);
        ws = null;
      };

      ws.onerror = (err) => {
        console.error("WebSocket error:", err);
      };
    }
  </script>
</body>

</html>
